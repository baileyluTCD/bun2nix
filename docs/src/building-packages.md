# Building Packages

`bun2nix` provides a simple helper derivation builder to help building packages with it's generated `bun.nix` file.

## Building with `mkBunDerivation`

`mkBunDerivation` is provided as a library function to build bun packages from the file generated by the [bun2nix command line tool](./using-the-command-line-tool.md).

Currently, basic usage would look something like:

```nix
{bun2nix, ...}:
bun2nix.mkBunDerivation {
  pname = "simple-bun-app";
  version = "1.0.0";

  src = ./.;

  bunNix = ./bun.nix;

  index = ./index.ts;
}
```

The full list of accepted arguments is:

| Argument     | Purpose                                                                                                                            |
| ------------ | ---------------------------------------------------------------------------------------------------------------------------------- |
| `pname`      | The name of the package to build                                                                                                   |
| `version`    | Your package version                                                                                                               |
| `src`        | The source code for your package                                                                                                   |
| `bunNix`     | The file generated by the `bun2nix` cli                                                                                            |
| `index`      | The index.{js,ts} file entry point to your bun application. If you do not have one, leave this empty and use a custom `buildPhase` |
| `buildFlags` | Optional flags to pass into `bun build` in the default `buildPhase`                                                                |

## Building with your own builder function

If you wish to attempt building with your own derivation function, there are some important things you may wish to know:

1. The generated `bun.nix` file contains build instructions for `node_modules` anything beyond that is your responsibility.
2. `bun.nix` is intended to be consumed by `pkgs.callPackage`. Once you have that you may access the generated node modules as an attribute of that package. Additionally, the package set of all the packages is exposed too in case you wish to tackle making `node_modules` yourself.
3. If you copy `node_modules` to your directory, be sure to preserve the symlinks in `.bin` which are important for running any program ran with `bunx`.
